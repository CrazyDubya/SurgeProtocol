# SURGE PROTOCOL - Cloudflare Workers Configuration
# https://developers.cloudflare.com/workers/wrangler/configuration/

name = "surge-protocol-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]
account_id = "18e002ebc857b38bc8fd572fee926f75"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "surge-protocol-db"
database_id = "d72bdef1-8719-4820-b906-d751414cdd86"
migrations_dir = "migrations"

# KV Namespace binding
[[kv_namespaces]]
binding = "CACHE"
id = "651042312ee340a097b3cb41cd7c3262"

# R2 Bucket binding
[[r2_buckets]]
binding = "ASSETS"
bucket_name = "surge-protocol-assets"

# Durable Objects
[[durable_objects.bindings]]
name = "COMBAT_SESSION"
class_name = "CombatSession"

[[durable_objects.bindings]]
name = "WAR_THEATER"
class_name = "WarTheater"

[[durable_objects.bindings]]
name = "WORLD_CLOCK"
class_name = "WorldClock"

# Durable Object migrations
[[migrations]]
tag = "v1"
new_classes = ["CombatSession", "WarTheater", "WorldClock"]

# Environment variables
[vars]
ENVIRONMENT = "development"

# Secrets (set via wrangler secret put)
# - JWT_SECRET: For JWT token signing
# - CF_MASTER_TOKEN: Master API token for creating child tokens
# - CF_ACCOUNT_ID: Cloudflare account ID

# Development environment
[env.development]
vars = { ENVIRONMENT = "development" }

# Staging environment
[env.staging]
vars = { ENVIRONMENT = "staging" }
d1_databases = [
  { binding = "DB", database_name = "surge-protocol-db-staging", database_id = "TBD" }
]

# Production environment
[env.production]
vars = { ENVIRONMENT = "production" }
d1_databases = [
  { binding = "DB", database_name = "surge-protocol-db-prod", database_id = "TBD" }
]

# Build configuration
[build]
command = "npm run build"
