<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Surge Protocol — Codebase Subway Map</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Inter:wght@400;600;700&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: #0a0a1a;
    color: #e0e0e0;
    font-family: 'Inter', 'Segoe UI', sans-serif;
    overflow: hidden;
    height: 100vh;
  }

  .header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    background: linear-gradient(180deg, #0a0a1a 60%, transparent);
    padding: 20px 30px 40px;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    pointer-events: none;
  }
  .header > * { pointer-events: auto; }
  .header h1 {
    font-family: 'JetBrains Mono', monospace;
    font-size: 22px;
    font-weight: 700;
    color: #00ffc8;
    text-shadow: 0 0 20px rgba(0,255,200,0.3);
    letter-spacing: 2px;
    text-transform: uppercase;
  }
  .header .subtitle {
    font-size: 12px;
    color: #666;
    margin-top: 4px;
    font-family: 'JetBrains Mono', monospace;
    letter-spacing: 1px;
  }

  .legend {
    position: fixed;
    bottom: 20px;
    left: 20px;
    z-index: 100;
    background: rgba(10,10,26,0.92);
    border: 1px solid #1e1e3a;
    border-radius: 12px;
    padding: 16px 20px;
    backdrop-filter: blur(10px);
    max-height: 70vh;
    overflow-y: auto;
  }
  .legend h3 {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: #888;
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 2px;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 6px;
    cursor: pointer;
    padding: 3px 6px;
    border-radius: 4px;
    transition: background 0.2s;
  }
  .legend-item:hover { background: rgba(255,255,255,0.05); }
  .legend-item .line-color {
    width: 28px;
    height: 6px;
    border-radius: 3px;
    flex-shrink: 0;
  }
  .legend-item .line-color.dashed {
    background: none !important;
    position: relative;
    overflow: hidden;
  }
  .legend-item .line-color.dashed::after {
    content: '';
    position: absolute;
    top: 1px;
    left: 0;
    right: 0;
    height: 4px;
    border-top: 4px dashed var(--dash-color);
  }
  .legend-item .line-name {
    font-size: 12px;
    font-weight: 600;
    white-space: nowrap;
  }
  .legend-item .line-desc {
    font-size: 10px;
    color: #666;
    white-space: nowrap;
  }

  .tooltip {
    position: fixed;
    z-index: 200;
    background: rgba(10,10,30,0.95);
    border: 1px solid #2a2a4a;
    border-radius: 10px;
    padding: 14px 18px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    max-width: 360px;
    backdrop-filter: blur(12px);
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
  }
  .tooltip.visible { opacity: 1; }
  .tooltip .tt-name {
    font-family: 'JetBrains Mono', monospace;
    font-size: 14px;
    font-weight: 700;
    margin-bottom: 4px;
  }
  .tooltip .tt-badge {
    display: inline-block;
    font-size: 9px;
    font-weight: 700;
    font-family: 'JetBrains Mono', monospace;
    padding: 2px 6px;
    border-radius: 3px;
    margin-left: 8px;
    vertical-align: middle;
    letter-spacing: 1px;
  }
  .tooltip .tt-badge.planned {
    background: rgba(255,152,0,0.2);
    color: #ff9800;
    border: 1px solid rgba(255,152,0,0.3);
  }
  .tooltip .tt-badge.built {
    background: rgba(0,230,118,0.15);
    color: #00e676;
    border: 1px solid rgba(0,230,118,0.2);
  }
  .tooltip .tt-badge.partial {
    background: rgba(255,235,59,0.15);
    color: #ffeb3b;
    border: 1px solid rgba(255,235,59,0.2);
  }
  .tooltip .tt-path {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: #00ffc8;
    margin-bottom: 6px;
    word-break: break-all;
  }
  .tooltip .tt-desc {
    font-size: 12px;
    color: #999;
    line-height: 1.4;
  }
  .tooltip .tt-lines {
    display: flex;
    gap: 4px;
    margin-top: 8px;
  }
  .tooltip .tt-line-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
  }

  .map-container {
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    cursor: grab;
  }
  .map-container.grabbing { cursor: grabbing; }

  svg { user-select: none; }

  .station { cursor: pointer; }
  .station:hover .station-dot { filter: brightness(1.4); }
  .station:hover .station-ring { opacity: 1; }
  .station-ring { opacity: 0; transition: opacity 0.2s; }

  @keyframes pulse {
    0%, 100% { opacity: 0.4; transform: scale(1); }
    50% { opacity: 0.1; transform: scale(1.8); }
  }
  .transfer-pulse {
    animation: pulse 3s ease-in-out infinite;
    transform-origin: center;
  }

  @keyframes constructionBlink {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 0.25; }
  }
  .planned-blink {
    animation: constructionBlink 4s ease-in-out infinite;
  }

  .line-path { transition: filter 0.3s, opacity 0.3s; }
  .line-path.highlighted { filter: drop-shadow(0 0 8px currentColor); }

  .controls {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 100;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .ctrl-btn {
    width: 40px;
    height: 40px;
    border: 1px solid #2a2a4a;
    border-radius: 8px;
    background: rgba(10,10,26,0.9);
    color: #888;
    font-size: 18px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    backdrop-filter: blur(10px);
    font-family: 'JetBrains Mono', monospace;
  }
  .ctrl-btn:hover {
    background: rgba(30,30,60,0.9);
    color: #ccc;
    border-color: #3a3a5a;
  }

  .zone-label {
    font-family: 'JetBrains Mono', monospace;
    font-weight: 700;
    letter-spacing: 6px;
    text-transform: uppercase;
    pointer-events: none;
  }

  .connection { stroke-dasharray: 6 4; opacity: 0.3; }
</style>
</head>
<body>

<div class="header">
  <div>
    <h1>Surge Protocol</h1>
    <div class="subtitle">Codebase Architecture — Subway Map</div>
  </div>
</div>

<div class="legend" id="legend">
  <h3>Active Lines</h3>
  <div class="legend-item" onmouseenter="highlightLine('red')" onmouseleave="unhighlightLine('red')">
    <div class="line-color" style="background:#ff3860"></div>
    <span class="line-name" style="color:#ff3860">API Express</span>
    <span class="line-desc">REST endpoints</span>
  </div>
  <div class="legend-item" onmouseenter="highlightLine('blue')" onmouseleave="unhighlightLine('blue')">
    <div class="line-color" style="background:#42a5f5"></div>
    <span class="line-name" style="color:#42a5f5">Frontend Line</span>
    <span class="line-desc">Preact UI pages</span>
  </div>
  <div class="legend-item" onmouseenter="highlightLine('green')" onmouseleave="unhighlightLine('green')">
    <div class="line-color" style="background:#00e676"></div>
    <span class="line-name" style="color:#00e676">Engine Line</span>
    <span class="line-desc">Game mechanics</span>
  </div>
  <div class="legend-item" onmouseenter="highlightLine('orange')" onmouseleave="unhighlightLine('orange')">
    <div class="line-color" style="background:#ff9100"></div>
    <span class="line-name" style="color:#ff9100">Realtime Express</span>
    <span class="line-desc">Durable Objects</span>
  </div>
  <div class="legend-item" onmouseenter="highlightLine('pink')" onmouseleave="unhighlightLine('pink')">
    <div class="line-color" style="background:#e91e63"></div>
    <span class="line-name" style="color:#e91e63">State Line</span>
    <span class="line-desc">Signal stores</span>
  </div>
  <div class="legend-item" onmouseenter="highlightLine('purple')" onmouseleave="unhighlightLine('purple')">
    <div class="line-color" style="background:#ab47bc"></div>
    <span class="line-name" style="color:#ab47bc">Data Line</span>
    <span class="line-desc">Database</span>
  </div>
  <div class="legend-item" onmouseenter="highlightLine('yellow')" onmouseleave="unhighlightLine('yellow')">
    <div class="line-color" style="background:#ffd740"></div>
    <span class="line-name" style="color:#ffd740">Infrastructure</span>
    <span class="line-desc">Middleware</span>
  </div>
  <div class="legend-item" onmouseenter="highlightLine('teal')" onmouseleave="unhighlightLine('teal')">
    <div class="line-color" style="background:#26c6da"></div>
    <span class="line-name" style="color:#26c6da">Narrative Line</span>
    <span class="line-desc">Story content</span>
  </div>

  <h3 style="margin-top:14px">Planned Lines</h3>
  <div class="legend-item" onmouseenter="highlightLine('gray')" onmouseleave="unhighlightLine('gray')">
    <div class="line-color dashed" style="--dash-color:#78909c"></div>
    <span class="line-name" style="color:#78909c">Multiplayer</span>
    <span class="line-desc">Social / crews</span>
  </div>
  <div class="legend-item" onmouseenter="highlightLine('white')" onmouseleave="unhighlightLine('white')">
    <div class="line-color dashed" style="--dash-color:#b0bec5"></div>
    <span class="line-name" style="color:#b0bec5">Consciousness</span>
    <span class="line-desc">Fork / ascension</span>
  </div>
  <div class="legend-item" onmouseenter="highlightLine('lime')" onmouseleave="unhighlightLine('lime')">
    <div class="line-color dashed" style="--dash-color:#c6ff00"></div>
    <span class="line-name" style="color:#c6ff00">Cybernetics Deep</span>
    <span class="line-desc">Augment systems</span>
  </div>

  <h3 style="margin-top:14px">Symbols</h3>
  <div class="legend-item">
    <svg width="28" height="20"><circle cx="14" cy="10" r="7" fill="none" stroke="#fff" stroke-width="2"/><circle cx="14" cy="10" r="3" fill="#fff"/></svg>
    <span class="line-name" style="color:#ccc;font-size:11px">Transfer Station</span>
  </div>
  <div class="legend-item">
    <svg width="28" height="20"><circle cx="14" cy="10" r="5" fill="#ff3860"/></svg>
    <span class="line-name" style="color:#ccc;font-size:11px">Active Station</span>
  </div>
  <div class="legend-item">
    <svg width="28" height="20"><circle cx="14" cy="10" r="5" fill="none" stroke="#ff9800" stroke-width="2" stroke-dasharray="3 2"/></svg>
    <span class="line-name" style="color:#ccc;font-size:11px">Planned Station</span>
  </div>
  <div class="legend-item">
    <svg width="28" height="20"><line x1="2" y1="10" x2="26" y2="10" stroke="#555" stroke-width="2" stroke-dasharray="4 3"/></svg>
    <span class="line-name" style="color:#ccc;font-size:11px">Cross-system link</span>
  </div>
</div>

<div class="tooltip" id="tooltip">
  <div class="tt-name" id="tt-name"></div>
  <div class="tt-path" id="tt-path"></div>
  <div class="tt-desc" id="tt-desc"></div>
  <div class="tt-lines" id="tt-lines"></div>
</div>

<div class="controls">
  <button class="ctrl-btn" onclick="zoomIn()" title="Zoom in">+</button>
  <button class="ctrl-btn" onclick="zoomOut()" title="Zoom out">-</button>
  <button class="ctrl-btn" onclick="resetView()" title="Reset view">H</button>
</div>

<div class="map-container" id="mapContainer">
<svg id="map" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1960 1700">
  <defs>
    <filter id="glow">
      <feGaussianBlur stdDeviation="3" result="blur"/>
      <feComposite in="SourceGraphic" in2="blur" operator="over"/>
    </filter>
  </defs>

  <!-- ===================== ZONE LABELS ===================== -->
  <text x="350" y="160" class="zone-label" fill="#111122" font-size="60">Frontend</text>
  <text x="250" y="470" class="zone-label" fill="#111122" font-size="48">State</text>
  <text x="500" y="750" class="zone-label" fill="#111122" font-size="60">Backend API</text>
  <text x="540" y="1100" class="zone-label" fill="#111122" font-size="48">Game Engine</text>
  <text x="80" y="1050" class="zone-label" fill="#111122" font-size="42">Data Layer</text>
  <text x="1100" y="1100" class="zone-label" fill="#111122" font-size="42">Narrative</text>
  <text x="850" y="340" class="zone-label" fill="#111122" font-size="42">Realtime</text>
  <text x="200" y="1550" class="zone-label" fill="#0d0d1e" font-size="50">Planned</text>
  <text x="1400" y="900" class="zone-label" fill="#0d0d1e" font-size="36">Planned</text>

  <!-- ===================== CROSS-SYSTEM CONNECTIONS ===================== -->
  <line x1="640" y1="150" x2="640" y2="460" class="connection" stroke="#555" stroke-width="2"/>
  <line x1="700" y1="700" x2="700" y2="460" class="connection" stroke="#555" stroke-width="2"/>
  <line x1="980" y1="150" x2="1060" y2="700" class="connection" stroke="#555" stroke-width="2"/>
  <line x1="1160" y1="460" x2="700" y2="1050" class="connection" stroke="#555" stroke-width="2"/>
  <line x1="810" y1="150" x2="1230" y2="700" class="connection" stroke="#555" stroke-width="2"/>
  <line x1="1660" y1="150" x2="1180" y2="310" class="connection" stroke="#555" stroke-width="2"/>

  <!-- ===================== ACTIVE LINE PATHS ===================== -->

  <!-- RED LINE: API Express -->
  <path d="M 700,700 L 1780,700"
        class="line-path" data-line="red"
        stroke="#ff3860" stroke-width="8" fill="none" stroke-linecap="round"/>

  <!-- YELLOW LINE: Infrastructure -->
  <path d="M 700,700 L 200,700 L 200,1020"
        class="line-path" data-line="yellow"
        stroke="#ffd740" stroke-width="8" fill="none" stroke-linecap="round" stroke-linejoin="round"/>

  <!-- GREEN LINE: Game Engine -->
  <path d="M 700,700 L 700,1400"
        class="line-path" data-line="green"
        stroke="#00e676" stroke-width="8" fill="none" stroke-linecap="round"/>

  <!-- ORANGE LINE: Realtime -->
  <path d="M 700,700 L 780,620 L 1300,200"
        class="line-path" data-line="orange"
        stroke="#ff9100" stroke-width="8" fill="none" stroke-linecap="round" stroke-linejoin="round"/>

  <!-- BLUE LINE: Frontend -->
  <path d="M 130,150 L 1660,150"
        class="line-path" data-line="blue"
        stroke="#42a5f5" stroke-width="8" fill="none" stroke-linecap="round"/>

  <!-- PINK LINE: State Stores -->
  <path d="M 640,150 L 640,460 L 1680,460"
        class="line-path" data-line="pink"
        stroke="#e91e63" stroke-width="8" fill="none" stroke-linecap="round" stroke-linejoin="round"/>

  <!-- PURPLE LINE: Data Layer -->
  <path d="M 700,700 L 150,1300"
        class="line-path" data-line="purple"
        stroke="#ab47bc" stroke-width="8" fill="none" stroke-linecap="round"/>

  <!-- TEAL LINE: Narrative -->
  <path d="M 1230,700 L 1230,1400"
        class="line-path" data-line="teal"
        stroke="#26c6da" stroke-width="8" fill="none" stroke-linecap="round"/>

  <!-- ===================== PLANNED LINE EXTENSIONS (dashed) ===================== -->

  <!-- RED LINE planned: south from Economy to Vendors/NPC/Stock -->
  <path d="M 1780,700 L 1780,1200"
        class="line-path planned-blink" data-line="red"
        stroke="#ff3860" stroke-width="6" fill="none" stroke-linecap="round" stroke-dasharray="12 8" opacity="0.5"/>

  <!-- GREEN LINE planned: east from Rating for Weather & Track Selection -->
  <path d="M 700,1220 L 1060,1220"
        class="line-path planned-blink" data-line="green"
        stroke="#00e676" stroke-width="6" fill="none" stroke-linecap="round" stroke-dasharray="12 8" opacity="0.5"/>

  <!-- ORANGE LINE planned: east from World Clock for War Phases / Territory -->
  <path d="M 1300,200 L 1640,200"
        class="line-path planned-blink" data-line="orange"
        stroke="#ff9100" stroke-width="6" fill="none" stroke-linecap="round" stroke-dasharray="12 8" opacity="0.5"/>

  <!-- TEAL LINE planned: east from Quest Design for Story Arcs / Achievements -->
  <path d="M 1230,1040 L 1600,1040 L 1600,1220"
        class="line-path planned-blink" data-line="teal"
        stroke="#26c6da" stroke-width="6" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="12 8" opacity="0.5"/>

  <!-- ===================== NEW PLANNED LINES (fully dashed) ===================== -->

  <!-- GRAY LINE: Multiplayer Social (horizontal bottom) -->
  <path d="M 280,1580 L 1140,1580"
        class="line-path planned-blink" data-line="gray"
        stroke="#78909c" stroke-width="6" fill="none" stroke-linecap="round" stroke-dasharray="12 8" opacity="0.45"/>

  <!-- WHITE LINE: Consciousness (branches west from Rating, then south) -->
  <path d="M 700,1220 L 380,1220 L 380,1580"
        class="line-path planned-blink" data-line="white"
        stroke="#b0bec5" stroke-width="6" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-dasharray="12 8" opacity="0.45"/>

  <!-- LIME LINE: Cybernetics Deep (branches south from Characters on Red, then east) -->
  <path d="M 1060,700 L 1060,870 L 1060,1060"
        class="line-path planned-blink" data-line="lime"
        stroke="#c6ff00" stroke-width="6" fill="none" stroke-linecap="round" stroke-dasharray="12 8" opacity="0.45"/>

  <!-- ===================== ACTIVE STATIONS ===================== -->

  <!-- ===== SURGE CENTRAL ===== -->
  <g class="station" data-name="Surge Central" data-path="src/index.ts" data-desc="Main entry point — Hono app init, route mounting, middleware, WebSocket handlers, Durable Object exports" data-lines="red,yellow,green,orange,purple" data-status="built">
    <circle cx="700" cy="700" r="20" fill="none" stroke="rgba(255,255,255,0.15)" stroke-width="1" class="transfer-pulse"/>
    <circle cx="700" cy="700" r="14" fill="#0a0a1a" stroke="#fff" stroke-width="3" class="station-dot"/>
    <circle cx="700" cy="700" r="5" fill="#fff"/>
    <circle cx="700" cy="700" r="20" fill="transparent" stroke="transparent" stroke-width="8" class="station-ring"/>
    <text x="716" y="740" fill="#fff" font-size="15" font-weight="700" font-family="JetBrains Mono, monospace">SURGE CENTRAL</text>
    <text x="716" y="756" fill="#666" font-size="10" font-family="JetBrains Mono, monospace">src/index.ts</text>
  </g>

  <!-- ===== RED LINE STATIONS ===== -->
  <g class="station" data-name="Auth" data-path="src/api/auth/index.ts" data-desc="Authentication routes — login, register, token refresh, session management via JWT" data-lines="red" data-status="built">
    <circle cx="880" cy="700" r="7" fill="#ff3860" class="station-dot"/>
    <circle cx="880" cy="700" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="865" y="687" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Auth</text>
  </g>

  <g class="station" data-name="Characters" data-path="src/api/characters/index.ts" data-desc="Character CRUD, progression, 8 attributes (PWR/AGI/END/VEL/INT/WIS/EMP/PRC), consciousness system" data-lines="red,teal,lime" data-status="built">
    <circle cx="1060" cy="700" r="12" fill="#0a0a1a" stroke="#fff" stroke-width="2.5" class="station-dot"/>
    <circle cx="1060" cy="700" r="4" fill="#fff"/>
    <circle cx="1060" cy="700" r="18" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1060" y="685" fill="#fff" font-size="13" font-weight="700" font-family="Inter, sans-serif" text-anchor="middle">Characters</text>
  </g>

  <g class="station" data-name="Missions" data-path="src/api/missions/index.ts" data-desc="Mission listing, acceptance, completion, rewards — connects to narrative quest system" data-lines="red,teal" data-status="built">
    <circle cx="1230" cy="700" r="12" fill="#0a0a1a" stroke="#fff" stroke-width="2.5" class="station-dot"/>
    <circle cx="1230" cy="700" r="4" fill="#fff"/>
    <circle cx="1230" cy="700" r="18" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1230" y="685" fill="#fff" font-size="13" font-weight="700" font-family="Inter, sans-serif" text-anchor="middle">Missions</text>
  </g>

  <g class="station" data-name="Factions" data-path="src/api/factions/index.ts" data-desc="Faction reputation, wars, territory control, leaderboards — war contributions partial" data-lines="red" data-status="partial">
    <circle cx="1390" cy="700" r="7" fill="#ff3860" class="station-dot"/>
    <circle cx="1390" cy="700" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1390" y="687" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Factions</text>
  </g>

  <g class="station" data-name="Skills" data-path="src/api/skills/index.ts" data-desc="Skill system endpoints — skill checks, progression, specializations" data-lines="red" data-status="built">
    <circle cx="1510" cy="700" r="7" fill="#ff3860" class="station-dot"/>
    <circle cx="1510" cy="700" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1510" y="687" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Skills</text>
  </g>

  <g class="station" data-name="World & Items" data-path="src/api/world/ & src/api/items/" data-desc="World state, environments, districts + item database, inventory, augmentations" data-lines="red" data-status="partial">
    <circle cx="1640" cy="700" r="7" fill="#ff3860" class="station-dot"/>
    <circle cx="1640" cy="700" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1640" y="687" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">World & Items</text>
  </g>

  <g class="station" data-name="Economy" data-path="src/api/economy/index.ts" data-desc="Currency, basic purchases — 40% complete. Missing: vendors, haggling, crafting, debt system" data-lines="red" data-status="partial">
    <circle cx="1780" cy="700" r="7" fill="#ff3860" class="station-dot"/>
    <circle cx="1780" cy="700" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1780" y="687" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Economy</text>
  </g>

  <!-- ===== YELLOW LINE STATIONS ===== -->
  <g class="station" data-name="CORS" data-path="src/middleware/" data-desc="Cross-Origin Resource Sharing configuration for API access" data-lines="yellow" data-status="built">
    <circle cx="530" cy="700" r="7" fill="#ffd740" class="station-dot"/>
    <circle cx="530" cy="700" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="530" y="687" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">CORS</text>
  </g>

  <g class="station" data-name="Logging" data-path="src/middleware/" data-desc="Request ID generation, timing, structured logging middleware" data-lines="yellow" data-status="built">
    <circle cx="370" cy="700" r="7" fill="#ffd740" class="station-dot"/>
    <circle cx="370" cy="700" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="370" y="687" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Logging</text>
  </g>

  <g class="station" data-name="Auth Middleware" data-path="src/middleware/auth.ts" data-desc="JWT verification, session storage, token generation (jose library)" data-lines="yellow" data-status="built">
    <circle cx="200" cy="700" r="7" fill="#ffd740" class="station-dot"/>
    <circle cx="200" cy="700" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="200" y="680" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Auth MW</text>
  </g>

  <g class="station" data-name="Rate Limiter" data-path="src/middleware/rateLimit.ts" data-desc="Dynamic and expensive operation rate limiting" data-lines="yellow" data-status="built">
    <circle cx="200" cy="860" r="7" fill="#ffd740" class="station-dot"/>
    <circle cx="200" cy="860" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="220" y="866" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif">Rate Limiter</text>
  </g>

  <g class="station" data-name="KV Cache" data-path="src/cache/" data-desc="Cloudflare KV namespace — session caching, temporary state, performance layer" data-lines="yellow" data-status="built">
    <circle cx="200" cy="1020" r="7" fill="#ffd740" class="station-dot"/>
    <circle cx="200" cy="1020" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="220" y="1026" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif">KV Cache</text>
  </g>

  <!-- ===== GREEN LINE STATIONS ===== -->
  <g class="station" data-name="Dice System" data-path="src/game/mechanics/dice.ts" data-desc="2d6 core system — skill checks, extended checks, criticals (snake eyes/boxcars), target numbers" data-lines="green" data-status="built">
    <circle cx="700" cy="870" r="7" fill="#00e676" class="station-dot"/>
    <circle cx="700" cy="870" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="720" y="876" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif">Dice System</text>
  </g>

  <g class="station" data-name="Combat Engine" data-path="src/game/mechanics/combat.ts" data-desc="Initiative (2d6+VEL), attacks, damage rolls, armor reduction, wound tracking — 75% complete" data-lines="green,orange" data-status="partial">
    <circle cx="700" cy="1050" r="12" fill="#0a0a1a" stroke="#fff" stroke-width="2.5" class="station-dot"/>
    <circle cx="700" cy="1050" r="4" fill="#fff"/>
    <circle cx="700" cy="1050" r="18" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="720" y="1046" fill="#fff" font-size="13" font-weight="700" font-family="Inter, sans-serif">Combat Engine</text>
    <text x="720" y="1062" fill="#666" font-size="10" font-family="JetBrains Mono, monospace">combat.ts + CombatSession DO</text>
  </g>

  <g class="station" data-name="Rating System" data-path="src/game/mechanics/rating.ts" data-desc="Carrier rating calculation — Tier 1-10 progression based on performance metrics" data-lines="green,white" data-status="built">
    <circle cx="700" cy="1220" r="12" fill="#0a0a1a" stroke="#fff" stroke-width="2.5" class="station-dot"/>
    <circle cx="700" cy="1220" r="4" fill="#fff"/>
    <circle cx="700" cy="1220" r="18" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="720" y="1216" fill="#fff" font-size="13" font-weight="700" font-family="Inter, sans-serif">Rating System</text>
    <text x="720" y="1232" fill="#666" font-size="10" font-family="JetBrains Mono, monospace">Tier 1-10 progression</text>
  </g>

  <g class="station" data-name="Dialogue System" data-path="src/game/dialogue/index.ts" data-desc="Dialogue trigger handling, conversation trees, NPC interaction logic — 30% complete" data-lines="green" data-status="partial">
    <circle cx="700" cy="1400" r="7" fill="#00e676" class="station-dot"/>
    <circle cx="700" cy="1400" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="720" y="1406" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif">Dialogue</text>
  </g>

  <!-- ===== ORANGE LINE STATIONS ===== -->
  <g class="station" data-name="WebSocket Hub" data-path="src/realtime/" data-desc="WebSocket endpoint routing — /ws/combat, /ws/war, /ws/war-theater, /ws/world" data-lines="orange" data-status="built">
    <circle cx="830" cy="590" r="7" fill="#ff9100" class="station-dot"/>
    <circle cx="830" cy="590" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="850" y="596" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif">WebSocket Hub</text>
  </g>

  <g class="station" data-name="Combat Session DO" data-path="src/realtime/combat.ts" data-desc="Durable Object — real-time combat state machine (initiative, turns, WebSocket per session)" data-lines="orange" data-status="built">
    <circle cx="990" cy="450" r="7" fill="#ff9100" class="station-dot"/>
    <circle cx="990" cy="450" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1010" y="446" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif">Combat Session</text>
    <text x="1010" y="462" fill="#666" font-size="10" font-family="JetBrains Mono, monospace">Durable Object</text>
  </g>

  <g class="station" data-name="War Theater DO" data-path="src/realtime/war.ts" data-desc="Durable Object — territory control, war scores, faction conflict. Missing: phase transitions, resolution" data-lines="orange" data-status="partial">
    <circle cx="1120" cy="340" r="7" fill="#ff9100" class="station-dot"/>
    <circle cx="1120" cy="340" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1140" y="336" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif">War Theater</text>
    <text x="1140" y="352" fill="#666" font-size="10" font-family="JetBrains Mono, monospace">Durable Object</text>
  </g>

  <g class="station" data-name="World Clock DO" data-path="src/realtime/world.ts" data-desc="Durable Object — shared game time, weather cycles. Missing: dynamic weather effects, scheduled events" data-lines="orange" data-status="partial">
    <circle cx="1300" cy="200" r="7" fill="#ff9100" class="station-dot"/>
    <circle cx="1300" cy="200" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1280" y="186" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="end">World Clock</text>
    <text x="1280" y="200" fill="#666" font-size="10" font-family="JetBrains Mono, monospace" text-anchor="end">Durable Object</text>
  </g>

  <!-- ===== BLUE LINE STATIONS ===== -->
  <g class="station" data-name="Login" data-path="frontend/src/pages/Login/" data-desc="Authentication UI — email/password form, error handling, redirect to dashboard" data-lines="blue" data-status="built">
    <circle cx="130" cy="150" r="7" fill="#42a5f5" class="station-dot"/>
    <circle cx="130" cy="150" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="130" y="135" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Login</text>
  </g>
  <g class="station" data-name="Register" data-path="frontend/src/pages/Register/" data-desc="Account creation wizard — username, email, password with validation" data-lines="blue" data-status="built">
    <circle cx="300" cy="150" r="7" fill="#42a5f5" class="station-dot"/>
    <circle cx="300" cy="150" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="300" y="135" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Register</text>
  </g>
  <g class="station" data-name="Character Select" data-path="frontend/src/pages/CharacterSelect/" data-desc="Character selection screen — list existing characters, option to create new" data-lines="blue" data-status="built">
    <circle cx="470" cy="150" r="7" fill="#42a5f5" class="station-dot"/>
    <circle cx="470" cy="150" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="470" y="135" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Char Select</text>
  </g>

  <g class="station" data-name="Dashboard" data-path="frontend/src/pages/Dashboard/" data-desc="Main game interface (lazy-loaded) — hub connecting to all game systems. Wireframed, components pending" data-lines="blue,pink" data-status="partial">
    <circle cx="640" cy="150" r="14" fill="none" stroke="rgba(255,255,255,0.15)" stroke-width="1" class="transfer-pulse"/>
    <circle cx="640" cy="150" r="12" fill="#0a0a1a" stroke="#fff" stroke-width="2.5" class="station-dot"/>
    <circle cx="640" cy="150" r="4" fill="#fff"/>
    <circle cx="640" cy="150" r="18" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="640" y="128" fill="#fff" font-size="14" font-weight="700" font-family="Inter, sans-serif" text-anchor="middle">Dashboard</text>
  </g>

  <g class="station" data-name="Missions Page" data-path="frontend/src/pages/Missions/" data-desc="Mission browser — available missions, active tracker, completion UI" data-lines="blue" data-status="built">
    <circle cx="810" cy="150" r="7" fill="#42a5f5" class="station-dot"/>
    <circle cx="810" cy="150" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="810" y="135" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Missions</text>
  </g>
  <g class="station" data-name="Character Page" data-path="frontend/src/pages/Character/" data-desc="Character sheet — attributes, progression, skills, augmentations view" data-lines="blue" data-status="built">
    <circle cx="980" cy="150" r="7" fill="#42a5f5" class="station-dot"/>
    <circle cx="980" cy="150" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="980" y="135" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Character</text>
  </g>
  <g class="station" data-name="Inventory Page" data-path="frontend/src/pages/Inventory/" data-desc="Item management UI — equipped gear, inventory grid, item details" data-lines="blue" data-status="built">
    <circle cx="1150" cy="150" r="7" fill="#42a5f5" class="station-dot"/>
    <circle cx="1150" cy="150" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1150" y="135" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Inventory</text>
  </g>
  <g class="station" data-name="Factions Page" data-path="frontend/src/pages/Factions/" data-desc="Faction standing, leaderboards, reputation display" data-lines="blue" data-status="built">
    <circle cx="1320" cy="150" r="7" fill="#42a5f5" class="station-dot"/>
    <circle cx="1320" cy="150" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1320" y="135" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Factions</text>
  </g>
  <g class="station" data-name="Algorithm Page" data-path="frontend/src/pages/Algorithm/" data-desc="AI character interaction terminal — The Algorithm dialogue interface" data-lines="blue" data-status="built">
    <circle cx="1490" cy="150" r="7" fill="#42a5f5" class="station-dot"/>
    <circle cx="1490" cy="150" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1490" y="135" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Algorithm</text>
  </g>
  <g class="station" data-name="War Page" data-path="frontend/src/pages/War/" data-desc="Faction war interface — territory map, live scores, war actions" data-lines="blue" data-status="built">
    <circle cx="1660" cy="150" r="7" fill="#42a5f5" class="station-dot"/>
    <circle cx="1660" cy="150" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1660" y="135" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">War</text>
  </g>

  <!-- ===== PINK LINE STATIONS ===== -->
  <g class="station" data-name="Auth Store" data-path="frontend/src/stores/authStore.ts" data-desc="Login state, JWT tokens, current user — Preact Signal store" data-lines="pink,blue" data-status="built">
    <circle cx="640" cy="460" r="12" fill="#0a0a1a" stroke="#fff" stroke-width="2.5" class="station-dot"/>
    <circle cx="640" cy="460" r="4" fill="#fff"/>
    <text x="640" y="490" fill="#ddd" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Auth Store</text>
  </g>
  <g class="station" data-name="Character Store" data-path="frontend/src/stores/characterStore.ts" data-desc="Selected character, attributes, progression state — Preact Signal" data-lines="pink" data-status="built">
    <circle cx="810" cy="460" r="6" fill="#e91e63" class="station-dot"/>
    <circle cx="810" cy="460" r="12" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="810" y="490" fill="#ddd" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Char Store</text>
  </g>
  <g class="station" data-name="Mission Store" data-path="frontend/src/stores/missionStore.ts" data-desc="Available/active missions state — Preact Signal" data-lines="pink" data-status="built">
    <circle cx="990" cy="460" r="6" fill="#e91e63" class="station-dot"/>
    <circle cx="990" cy="460" r="12" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="990" y="490" fill="#ddd" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Mission Store</text>
  </g>
  <g class="station" data-name="Combat Store" data-path="frontend/src/stores/combatStore.ts" data-desc="Current combat state, actions, initiative order — Preact Signal" data-lines="pink" data-status="built">
    <circle cx="1160" cy="460" r="6" fill="#e91e63" class="station-dot"/>
    <circle cx="1160" cy="460" r="12" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1160" y="490" fill="#ddd" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Combat Store</text>
  </g>
  <g class="station" data-name="War Store" data-path="frontend/src/stores/warTheaterStore.ts" data-desc="War information, territory standings — Preact Signal" data-lines="pink" data-status="built">
    <circle cx="1330" cy="460" r="6" fill="#e91e63" class="station-dot"/>
    <circle cx="1330" cy="460" r="12" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1330" y="490" fill="#ddd" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">War Store</text>
  </g>
  <g class="station" data-name="World Store" data-path="frontend/src/stores/worldClockStore.ts" data-desc="Game time, weather state — Preact Signal" data-lines="pink" data-status="built">
    <circle cx="1500" cy="460" r="6" fill="#e91e63" class="station-dot"/>
    <circle cx="1500" cy="460" r="12" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1500" y="490" fill="#ddd" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">World Store</text>
  </g>
  <g class="station" data-name="UI Store" data-path="frontend/src/stores/uiStore.ts" data-desc="UI state — modals, panels, theme, loading states — Preact Signal" data-lines="pink" data-status="built">
    <circle cx="1680" cy="460" r="6" fill="#e91e63" class="station-dot"/>
    <circle cx="1680" cy="460" r="12" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1680" y="490" fill="#ddd" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">UI Store</text>
  </g>

  <!-- ===== PURPLE LINE STATIONS ===== -->
  <g class="station" data-name="DB Types" data-path="src/db/types.ts" data-desc="TypeScript type definitions for all 270 database tables" data-lines="purple" data-status="built">
    <circle cx="562" cy="838" r="7" fill="#ab47bc" class="station-dot"/>
    <circle cx="562" cy="838" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="544" y="830" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="end">DB Types</text>
  </g>
  <g class="station" data-name="Queries" data-path="src/db/queries.ts" data-desc="60+ database query functions — character, mission, inventory, faction, combat, skills" data-lines="purple" data-status="built">
    <circle cx="424" cy="976" r="7" fill="#ab47bc" class="station-dot"/>
    <circle cx="424" cy="976" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="406" y="968" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="end">Queries</text>
    <text x="406" y="984" fill="#666" font-size="10" font-family="JetBrains Mono, monospace" text-anchor="end">60+ functions</text>
  </g>
  <g class="station" data-name="Seed Data" data-path="src/db/seed.ts" data-desc="Development data seeding — initial game data population" data-lines="purple" data-status="built">
    <circle cx="287" cy="1114" r="7" fill="#ab47bc" class="station-dot"/>
    <circle cx="287" cy="1114" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="269" y="1108" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif" text-anchor="end">Seed Data</text>
  </g>
  <g class="station" data-name="Migrations" data-path="migrations/" data-desc="10 SQL migration files — 270 tables covering enums, characters, augmentation, skills, missions, economy, combat, narrative, persistence" data-lines="purple" data-status="built">
    <circle cx="150" cy="1252" r="9" fill="#ab47bc" class="station-dot"/>
    <circle cx="150" cy="1252" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="170" y="1248" fill="#ddd" font-size="14" font-weight="700" font-family="Inter, sans-serif">Migrations</text>
    <text x="170" y="1266" fill="#666" font-size="10" font-family="JetBrains Mono, monospace">270 tables - D1 SQLite</text>
  </g>

  <!-- ===== TEAL LINE STATIONS ===== -->
  <g class="station" data-name="NPC Characters" data-path="surge-narrative/01_CHARACTERS/" data-desc="NPC character profiles — backstories, motivations, dialogue styles, relationship maps" data-lines="teal" data-status="built">
    <circle cx="1230" cy="870" r="7" fill="#26c6da" class="station-dot"/>
    <circle cx="1230" cy="870" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1250" y="876" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif">NPCs</text>
  </g>
  <g class="station" data-name="Quest Design" data-path="surge-narrative/03_QUESTS/" data-desc="Quest design documents — objectives, branching paths, rewards, failure conditions" data-lines="teal" data-status="built">
    <circle cx="1230" cy="1040" r="7" fill="#26c6da" class="station-dot"/>
    <circle cx="1230" cy="1040" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1250" y="1046" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif">Quest Design</text>
  </g>
  <g class="station" data-name="Complications" data-path="surge-narrative/04_COMPLICATIONS/" data-desc="Mission complications — dynamic events, environmental hazards, NPC interference" data-lines="teal" data-status="built">
    <circle cx="1230" cy="1210" r="7" fill="#26c6da" class="station-dot"/>
    <circle cx="1230" cy="1210" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1250" y="1216" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif">Complications</text>
  </g>
  <g class="station" data-name="Procedural Content" data-path="surge-narrative/11_PROCEDURAL/" data-desc="Procedural encounter generation — random events, dynamic world content, district modifiers" data-lines="teal" data-status="built">
    <circle cx="1230" cy="1400" r="7" fill="#26c6da" class="station-dot"/>
    <circle cx="1230" cy="1400" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1250" y="1406" fill="#ddd" font-size="13" font-weight="600" font-family="Inter, sans-serif">Procedural</text>
  </g>

  <!-- ===================== PLANNED STATIONS ===================== -->

  <!-- RED LINE PLANNED: south from Economy -->
  <g class="station" data-name="Vendors API" data-path="src/api/economy/" data-desc="PLANNED — Dynamic vendor inventory, haggling with Charisma checks, price scaling by faction rep, stock refresh cycles" data-lines="red" data-status="planned">
    <circle cx="1780" cy="860" r="7" fill="none" stroke="#ff3860" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="1780" cy="860" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1800" y="856" fill="#ff386088" font-size="12" font-weight="600" font-family="Inter, sans-serif">Vendors</text>
    <text x="1800" y="872" fill="#ff386055" font-size="9" font-family="JetBrains Mono, monospace">PLANNED</text>
  </g>

  <g class="station" data-name="NPC Dialogue API" data-path="src/api/npcs/" data-desc="PLANNED — NPC catalog, dialogue tree retrieval, conversation initiation, personality-driven variants" data-lines="red" data-status="planned">
    <circle cx="1780" cy="1020" r="7" fill="none" stroke="#ff3860" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="1780" cy="1020" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1800" y="1016" fill="#ff386088" font-size="12" font-weight="600" font-family="Inter, sans-serif">NPC API</text>
    <text x="1800" y="1032" fill="#ff386055" font-size="9" font-family="JetBrains Mono, monospace">PLANNED</text>
  </g>

  <g class="station" data-name="Stock Market" data-path="documentation/schema/5EconomyContracts.md" data-desc="PLANNED — Stock definitions, player portfolios, price fluctuation. Schema designed, zero API" data-lines="red" data-status="planned">
    <circle cx="1780" cy="1180" r="7" fill="none" stroke="#ff3860" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="1780" cy="1180" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1800" y="1176" fill="#ff386088" font-size="12" font-weight="600" font-family="Inter, sans-serif">Stock Market</text>
    <text x="1800" y="1192" fill="#ff386055" font-size="9" font-family="JetBrains Mono, monospace">PLANNED</text>
  </g>

  <!-- GREEN LINE PLANNED: east from Rating -->
  <g class="station" data-name="Weather & Time" data-path="documentation/schema/8MetaSystems.md" data-desc="PLANNED — Dynamic weather effects on missions, weather transitions, time-of-day difficulty scaling, seasonal events" data-lines="green" data-status="planned">
    <circle cx="860" cy="1220" r="7" fill="none" stroke="#00e676" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="860" cy="1220" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="860" y="1205" fill="#00e67688" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Weather</text>
    <text x="860" y="1253" fill="#00e67655" font-size="9" font-family="JetBrains Mono, monospace" text-anchor="middle">PLANNED</text>
  </g>

  <g class="station" data-name="Track Selection" data-path="SURGE_STORIES_BY_TIER.md" data-desc="PLANNED — Tier 3 track choice: VECTOR (speed), SENTINEL (defense), NETWEAVER (hacking), INTERFACE (social), MACHINIST (hardware)" data-lines="green" data-status="planned">
    <circle cx="1020" cy="1220" r="7" fill="none" stroke="#00e676" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="1020" cy="1220" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1020" y="1205" fill="#00e67688" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Tracks</text>
    <text x="1020" y="1253" fill="#00e67655" font-size="9" font-family="JetBrains Mono, monospace" text-anchor="middle">PLANNED / TIER 3</text>
  </g>

  <!-- ORANGE LINE PLANNED: east from World Clock -->
  <g class="station" data-name="War Phases" data-path="FACTION_WARFARE.md" data-desc="PLANNED — War phase transitions: ESCALATION -> COMBAT -> RESOLUTION. Victory conditions, post-war territory changes" data-lines="orange" data-status="planned">
    <circle cx="1460" cy="200" r="7" fill="none" stroke="#ff9100" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="1460" cy="200" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1460" y="186" fill="#ff910088" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">War Phases</text>
    <text x="1460" y="226" fill="#ff910055" font-size="9" font-family="JetBrains Mono, monospace" text-anchor="middle">PLANNED</text>
  </g>

  <g class="station" data-name="Territory Control" data-path="FACTION_WARFARE.md" data-desc="PLANNED — Territory percentage updates, faction-specific war missions, territory disputes, war event triggers" data-lines="orange" data-status="planned">
    <circle cx="1620" cy="200" r="7" fill="none" stroke="#ff9100" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="1620" cy="200" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1620" y="186" fill="#ff910088" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Territory</text>
    <text x="1620" y="226" fill="#ff910055" font-size="9" font-family="JetBrains Mono, monospace" text-anchor="middle">PLANNED</text>
  </g>

  <!-- TEAL LINE PLANNED: east from Quest Design -->
  <g class="station" data-name="Story Arcs" data-path="documentation/schema/7narrativedialogue.md" data-desc="PLANNED — 6 story arcs: The Delivery (main), Corporate Ladder, Burn Notice, Solidarity, Convergence, Transcendence. Schema only" data-lines="teal" data-status="planned">
    <circle cx="1410" cy="1040" r="7" fill="none" stroke="#26c6da" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="1410" cy="1040" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1430" y="1036" fill="#26c6da88" font-size="12" font-weight="600" font-family="Inter, sans-serif">Story Arcs</text>
    <text x="1430" y="1052" fill="#26c6da55" font-size="9" font-family="JetBrains Mono, monospace">PLANNED / 6 ARCS</text>
  </g>

  <g class="station" data-name="Achievements" data-path="documentation/schema/8MetaSystems.md" data-desc="PLANNED — Achievement definitions, character unlocks, milestones. Categories: STORY, DELIVERY, COMBAT, EXPLORATION, SOCIAL, COLLECTION, SECRET" data-lines="teal" data-status="planned">
    <circle cx="1600" cy="1040" r="7" fill="none" stroke="#26c6da" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="1600" cy="1040" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1620" y="1036" fill="#26c6da88" font-size="12" font-weight="600" font-family="Inter, sans-serif">Achievements</text>
    <text x="1620" y="1052" fill="#26c6da55" font-size="9" font-family="JetBrains Mono, monospace">PLANNED</text>
  </g>

  <g class="station" data-name="Dialogue Trees" data-path="documentation/schema/7narrativedialogue.md" data-desc="PLANNED — Full branching dialogue engine, NPC personality variants, dynamic generation based on relationship/faction standing" data-lines="teal" data-status="planned">
    <circle cx="1600" cy="1200" r="7" fill="none" stroke="#26c6da" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="1600" cy="1200" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1620" y="1196" fill="#26c6da88" font-size="12" font-weight="600" font-family="Inter, sans-serif">Dialogue Trees</text>
    <text x="1620" y="1212" fill="#26c6da55" font-size="9" font-family="JetBrains Mono, monospace">PLANNED</text>
  </g>

  <!-- ===== GRAY LINE PLANNED: Multiplayer Social ===== -->
  <g class="station" data-name="Crews" data-path="documentation/schema/10MultiplayerSocial.md" data-desc="PLANNED — Crew creation, management, shared bank/inventory, permissions, ranks, crew wars. Schema defined, zero API" data-lines="gray" data-status="planned">
    <circle cx="280" cy="1580" r="7" fill="none" stroke="#78909c" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="280" cy="1580" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="280" y="1565" fill="#78909c88" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Crews</text>
    <text x="280" y="1612" fill="#78909c55" font-size="9" font-family="JetBrains Mono, monospace" text-anchor="middle">PLANNED</text>
  </g>

  <g class="station" data-name="Leaderboards" data-path="documentation/schema/10MultiplayerSocial.md" data-desc="PLANNED — 7 leaderboard types: weekly deliveries, all-time rating, daily speed, monthly credits, distance, perfect runs, top crews" data-lines="gray" data-status="planned">
    <circle cx="490" cy="1580" r="7" fill="none" stroke="#78909c" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="490" cy="1580" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="490" y="1565" fill="#78909c88" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Leaderboards</text>
    <text x="490" y="1612" fill="#78909c55" font-size="9" font-family="JetBrains Mono, monospace" text-anchor="middle">PLANNED</text>
  </g>

  <g class="station" data-name="Messaging" data-path="documentation/schema/10MultiplayerSocial.md" data-desc="PLANNED — Direct messaging, friend requests, notifications, crew announcements. Schema defined, zero API" data-lines="gray" data-status="planned">
    <circle cx="700" cy="1580" r="7" fill="none" stroke="#78909c" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="700" cy="1580" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="700" y="1565" fill="#78909c88" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Messaging</text>
    <text x="700" y="1612" fill="#78909c55" font-size="9" font-family="JetBrains Mono, monospace" text-anchor="middle">PLANNED</text>
  </g>

  <g class="station" data-name="Friends & Trading" data-path="documentation/schema/10MultiplayerSocial.md" data-desc="PLANNED — Friendship system, gifting, item trading between players. Schema defined, zero API" data-lines="gray" data-status="planned">
    <circle cx="930" cy="1580" r="7" fill="none" stroke="#78909c" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="930" cy="1580" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="930" y="1565" fill="#78909c88" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Friends & Trading</text>
    <text x="930" y="1612" fill="#78909c55" font-size="9" font-family="JetBrains Mono, monospace" text-anchor="middle">PLANNED</text>
  </g>

  <g class="station" data-name="Analytics" data-path="documentation/schema/11AnalyticsConfigEnum.md" data-desc="PLANNED — Telemetry, player metrics, economy health dashboard. 36 enum tables defined, zero implementation" data-lines="gray" data-status="planned">
    <circle cx="1140" cy="1580" r="7" fill="none" stroke="#78909c" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="1140" cy="1580" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1140" y="1565" fill="#78909c88" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="middle">Analytics</text>
    <text x="1140" y="1612" fill="#78909c55" font-size="9" font-family="JetBrains Mono, monospace" text-anchor="middle">PLANNED</text>
  </g>

  <!-- ===== WHITE LINE PLANNED: Consciousness ===== -->
  <g class="station" data-name="Humanity System" data-path="documentation/schema/2Augmentation.md" data-desc="PLANNED — Humanity degradation thresholds: Baseline(80-100), Chrome-Touched(60-79), Wired(40-59), Ghost(20-39), Edge(1-19), Cyberpsycho(0)" data-lines="white" data-status="planned">
    <circle cx="540" cy="1220" r="7" fill="none" stroke="#b0bec5" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="540" cy="1220" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="522" y="1212" fill="#b0bec588" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="end">Humanity</text>
    <text x="522" y="1228" fill="#b0bec555" font-size="9" font-family="JetBrains Mono, monospace" text-anchor="end">PLANNED</text>
  </g>

  <g class="station" data-name="Fork Divergence" data-path="FORK_DIVERGENCE.md" data-desc="PLANNED — Mind upload at Tier 9, consciousness split (original vs copy), dual consciousness management, skill sharing between forks" data-lines="white" data-status="planned">
    <circle cx="380" cy="1220" r="7" fill="none" stroke="#b0bec5" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="380" cy="1220" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="362" y="1212" fill="#b0bec588" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="end">Fork Divergence</text>
    <text x="362" y="1228" fill="#b0bec555" font-size="9" font-family="JetBrains Mono, monospace" text-anchor="end">PLANNED / TIER 9</text>
  </g>

  <g class="station" data-name="Mind Upload" data-path="FORK_DIVERGENCE.md" data-desc="PLANNED — Consciousness digitization, experience sharing between forks, convergence vs permanent split endings" data-lines="white" data-status="planned">
    <circle cx="380" cy="1400" r="7" fill="none" stroke="#b0bec5" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="380" cy="1400" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="362" y="1396" fill="#b0bec588" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="end">Mind Upload</text>
    <text x="362" y="1412" fill="#b0bec555" font-size="9" font-family="JetBrains Mono, monospace" text-anchor="end">PLANNED</text>
  </g>

  <g class="station" data-name="Ascension Paths" data-path="SURGE_STORIES_BY_TIER.md" data-desc="PLANNED — Tier 9+ endgame paths: Corporate, Rogue, Union, Network Convergence, Refusal. Design doc only" data-lines="white" data-status="planned">
    <circle cx="380" cy="1580" r="7" fill="none" stroke="#b0bec5" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="380" cy="1580" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="362" y="1576" fill="#b0bec588" font-size="12" font-weight="600" font-family="Inter, sans-serif" text-anchor="end">Ascension</text>
    <text x="362" y="1592" fill="#b0bec555" font-size="9" font-family="JetBrains Mono, monospace" text-anchor="end">PLANNED / ENDGAME</text>
  </g>

  <!-- ===== LIME LINE PLANNED: Cybernetics Deep ===== -->
  <g class="station" data-name="Augment Installation" data-path="documentation/schema/2Augmentation.md" data-desc="PLANNED — Surgery mechanics, rejection risk, body location damage multipliers, maintenance scheduling, malfunction system" data-lines="lime" data-status="planned">
    <circle cx="1060" cy="870" r="7" fill="none" stroke="#c6ff00" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="1060" cy="870" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1080" y="866" fill="#c6ff0088" font-size="12" font-weight="600" font-family="Inter, sans-serif">Installation</text>
    <text x="1080" y="882" fill="#c6ff0055" font-size="9" font-family="JetBrains Mono, monospace">PLANNED</text>
  </g>

  <g class="station" data-name="Synergy Sets" data-path="documentation/schema/2Augmentation.md" data-desc="PLANNED — Augment set bonuses, manufacturer reputation, synergy combinations. Tables defined, no logic" data-lines="lime" data-status="planned">
    <circle cx="1060" cy="960" r="7" fill="none" stroke="#c6ff00" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="1060" cy="960" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1080" y="956" fill="#c6ff0088" font-size="12" font-weight="600" font-family="Inter, sans-serif">Synergy Sets</text>
    <text x="1080" y="972" fill="#c6ff0055" font-size="9" font-family="JetBrains Mono, monospace">PLANNED</text>
  </g>

  <g class="station" data-name="Black Market" data-path="documentation/schema/2Augmentation.md" data-desc="PLANNED — Tiered illicit augments: Combat Chems (T3+), Unlicensed Cyberware (T4+), Experimental Tech (T6+), Corrupted Tech (ROGUE only)" data-lines="lime" data-status="planned">
    <circle cx="1060" cy="1050" r="7" fill="none" stroke="#c6ff00" stroke-width="2" stroke-dasharray="3 2" class="station-dot planned-blink"/>
    <circle cx="1060" cy="1050" r="14" fill="transparent" stroke="transparent" class="station-ring"/>
    <text x="1080" y="1046" fill="#c6ff0088" font-size="12" font-weight="600" font-family="Inter, sans-serif">Black Market</text>
    <text x="1080" y="1062" fill="#c6ff0055" font-size="9" font-family="JetBrains Mono, monospace">PLANNED / T3+</text>
  </g>

  <!-- ===================== ZONE DECORATIONS ===================== -->
  <rect x="60" y="80" width="1660" height="130" rx="16" fill="none" stroke="#1a1a3a" stroke-width="1" stroke-dasharray="8 4"/>
  <rect x="570" y="400" width="1170" height="120" rx="16" fill="none" stroke="#1a1a3a" stroke-width="1" stroke-dasharray="8 4"/>

  <!-- Planned zone outline -->
  <rect x="220" y="1530" width="980" height="100" rx="12" fill="none" stroke="#252535" stroke-width="1" stroke-dasharray="6 4"/>
  <rect x="310" y="1170" width="140" height="100" rx="12" fill="none" stroke="#252535" stroke-width="1" stroke-dasharray="6 4"/>

  <!-- ===================== WATERMARK ===================== -->
  <text x="1880" y="1670" fill="#151530" font-size="14" font-family="JetBrains Mono, monospace" text-anchor="end">
    Cloudflare Workers - Hono - Preact - D1 - KV - R2 - Durable Objects
  </text>

</svg>
</div>

<script>
const container = document.getElementById('mapContainer');
const svg = document.getElementById('map');
let scale = 1, panX = 0, panY = 0;
let isPanning = false, startX, startY;
const MIN_SCALE = 0.25, MAX_SCALE = 3;

function updateTransform() {
  svg.style.transform = `translate(${panX}px, ${panY}px) scale(${scale})`;
  svg.style.transformOrigin = '0 0';
}

container.addEventListener('mousedown', e => {
  if (e.target.closest('.station')) return;
  isPanning = true;
  startX = e.clientX - panX;
  startY = e.clientY - panY;
  container.classList.add('grabbing');
});
window.addEventListener('mousemove', e => {
  if (!isPanning) return;
  panX = e.clientX - startX;
  panY = e.clientY - startY;
  updateTransform();
});
window.addEventListener('mouseup', () => { isPanning = false; container.classList.remove('grabbing'); });

container.addEventListener('wheel', e => {
  e.preventDefault();
  const delta = e.deltaY > 0 ? 0.9 : 1.1;
  const newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, scale * delta));
  const rect = container.getBoundingClientRect();
  const mx = e.clientX - rect.left, my = e.clientY - rect.top;
  panX = mx - (mx - panX) * (newScale / scale);
  panY = my - (my - panY) * (newScale / scale);
  scale = newScale;
  updateTransform();
}, { passive: false });

function zoomIn() {
  const ns = Math.min(MAX_SCALE, scale * 1.3);
  const cx = container.clientWidth/2, cy = container.clientHeight/2;
  panX = cx - (cx - panX) * (ns / scale); panY = cy - (cy - panY) * (ns / scale);
  scale = ns; updateTransform();
}
function zoomOut() {
  const ns = Math.max(MIN_SCALE, scale * 0.7);
  const cx = container.clientWidth/2, cy = container.clientHeight/2;
  panX = cx - (cx - panX) * (ns / scale); panY = cy - (cy - panY) * (ns / scale);
  scale = ns; updateTransform();
}
function resetView() {
  const vw = container.clientWidth, vh = container.clientHeight;
  scale = Math.min(vw / 1960, vh / 1700) * 0.9;
  panX = (vw - 1960 * scale) / 2;
  panY = (vh - 1700 * scale) / 2;
  updateTransform();
}
resetView();

// Tooltip
const tooltip = document.getElementById('tooltip');
const ttName = document.getElementById('tt-name');
const ttPath = document.getElementById('tt-path');
const ttDesc = document.getElementById('tt-desc');
const ttLines = document.getElementById('tt-lines');

const lineColors = {
  red:'#ff3860', blue:'#42a5f5', green:'#00e676', orange:'#ff9100',
  pink:'#e91e63', purple:'#ab47bc', yellow:'#ffd740', teal:'#26c6da',
  gray:'#78909c', white:'#b0bec5', lime:'#c6ff00'
};
const lineNames = {
  red:'API Express', blue:'Frontend Line', green:'Engine Line', orange:'Realtime Express',
  pink:'State Line', purple:'Data Line', yellow:'Infrastructure', teal:'Narrative Line',
  gray:'Multiplayer', white:'Consciousness', lime:'Cybernetics Deep'
};

document.querySelectorAll('.station').forEach(station => {
  station.addEventListener('mouseenter', () => {
    const name = station.dataset.name;
    const path = station.dataset.path;
    const desc = station.dataset.desc;
    const status = station.dataset.status;
    const lines = station.dataset.lines ? station.dataset.lines.split(',') : [];

    let badge = '';
    if (status === 'planned') badge = '<span class="tt-badge planned">PLANNED</span>';
    else if (status === 'partial') badge = '<span class="tt-badge partial">IN PROGRESS</span>';
    else badge = '<span class="tt-badge built">BUILT</span>';

    ttName.innerHTML = name + badge;
    ttName.style.color = lines.length > 0 ? lineColors[lines[0]] : '#fff';
    ttPath.textContent = path;
    ttDesc.textContent = desc;

    ttLines.innerHTML = '';
    lines.forEach(l => {
      const dot = document.createElement('div');
      dot.className = 'tt-line-dot';
      dot.style.background = lineColors[l];
      dot.title = lineNames[l];
      ttLines.appendChild(dot);
    });
    tooltip.classList.add('visible');
  });
  station.addEventListener('mousemove', e => {
    let x = e.clientX + 16, y = e.clientY + 16;
    const tw = tooltip.offsetWidth, th = tooltip.offsetHeight;
    if (x + tw > window.innerWidth) x = e.clientX - tw - 16;
    if (y + th > window.innerHeight) y = e.clientY - th - 16;
    tooltip.style.left = x + 'px'; tooltip.style.top = y + 'px';
  });
  station.addEventListener('mouseleave', () => tooltip.classList.remove('visible'));
});

// Line highlighting
function highlightLine(lineName) {
  document.querySelectorAll('.line-path').forEach(p => {
    if (p.dataset.line === lineName) {
      p.classList.add('highlighted');
      p.style.filter = `drop-shadow(0 0 8px ${lineColors[lineName]})`;
      p.style.opacity = '';
    } else {
      p.style.opacity = '0.08';
    }
  });
  document.querySelectorAll('.station').forEach(s => {
    const lines = s.dataset.lines ? s.dataset.lines.split(',') : [];
    if (!lines.includes(lineName)) s.style.opacity = '0.1';
  });
}
function unhighlightLine() {
  document.querySelectorAll('.line-path').forEach(p => {
    p.classList.remove('highlighted');
    p.style.filter = '';
    p.style.opacity = '';
  });
  document.querySelectorAll('.station').forEach(s => { s.style.opacity = ''; });
}

// Touch support
let lastDist=0;
container.addEventListener('touchstart', e => {
  if (e.touches.length===1) { isPanning=true; startX=e.touches[0].clientX-panX; startY=e.touches[0].clientY-panY; }
  else if (e.touches.length===2) { isPanning=false; const dx=e.touches[0].clientX-e.touches[1].clientX,dy=e.touches[0].clientY-e.touches[1].clientY; lastDist=Math.sqrt(dx*dx+dy*dy); }
}, {passive:true});
container.addEventListener('touchmove', e => {
  e.preventDefault();
  if (e.touches.length===1 && isPanning) { panX=e.touches[0].clientX-startX; panY=e.touches[0].clientY-startY; updateTransform(); }
  else if (e.touches.length===2) {
    const dx=e.touches[0].clientX-e.touches[1].clientX,dy=e.touches[0].clientY-e.touches[1].clientY;
    const dist=Math.sqrt(dx*dx+dy*dy), ns=Math.max(MIN_SCALE,Math.min(MAX_SCALE,scale*(dist/lastDist)));
    const cx=(e.touches[0].clientX+e.touches[1].clientX)/2,cy=(e.touches[0].clientY+e.touches[1].clientY)/2;
    panX=cx-(cx-panX)*(ns/scale); panY=cy-(cy-panY)*(ns/scale); scale=ns; lastDist=dist; updateTransform();
  }
}, {passive:false});
container.addEventListener('touchend', () => { isPanning=false; });
window.addEventListener('resize', resetView);
</script>
</body>
</html>
